# 転倒数

ten(v)に入れたら勝手に座標圧縮されて転倒数が帰ってくる

セグ木が一緒についてきてるのでセグ木を別で定義してる場合は気を付ける


```cpp

class st{
public:
    long long siz = 1;
    vector<long long> v;
    st (long long n){
        siz = 1;
        while(siz < n)siz *= 2;
        v.assign(2*siz,0);
    }
    void plus(long long i){
        i += siz;
        v[i]++;
        while(i > 1){
            i /= 2;
            v[i] = v[i*2]+v[i*2+1];
        }
    } 
    long long query(long long L, long long R){   // 添字、L , R
        long long ans = 0;
        function<void(long long,long long,long long)> f = [&](long long s,long long l,long long r){
            if(l >= L && r <= R){
                ans += v[s];
                return;
            }
            if(r < L || l > R)return;
            f(s*2,l,(l+r)/2);
            f(s*2+1,(l+r)/2+1,r);
            return;
        };
        f(1,0,siz-1);
        return ans;
    }
};
void ash(map<long long,long long>& m,vector<long long> v){
    long long n = v.size();
    m.clear();
    sort(v.begin(),v.end());
    long long j = 0;
    for(long long i = 0;i < n;i++){
        if(m.count(v[i]))continue;
        m[v[i]] = j;
        j++;
    }
    return ;
}
long long ten(vector<long long> v){
    long long n = v.size();
    map<long long,long long> m;
    ash(m,v);
    st seg(m.size());
    long long ans = 0;
    for(int i = 0;i < n;i++){
        ans += seg.query(m[v[i]]+1,m.size()-1);
        seg.plus(m[v[i]]);
    }
    return ans;
}

```

# 逆転倒数

```cpp


class st{
public:
    long long siz = 1;
    vector<long long> v;
    st (long long n){
        siz = 1;
        while(siz < n)siz *= 2;
        v.assign(2*siz,0);
    }
    void plus(long long i){
        i += siz;
        v[i]++;
        while(i > 1){
            i /= 2;
            v[i] = v[i*2]+v[i*2+1];
        }
    } 
    long long query(long long L, long long R){   // 添字、L , R
        long long ans = 0;
        function<void(long long,long long,long long)> f = [&](long long s,long long l,long long r){
            if(l >= L && r <= R){
                ans += v[s];
                return;
            }
            if(r < L || l > R)return;
            f(s*2,l,(l+r)/2);
            f(s*2+1,(l+r)/2+1,r);
            return;
        };
        f(1,0,siz-1);
        return ans;
    }
};
void ash(map<long long,long long>& m,vector<long long> v){
    long long n = v.size();
    m.clear();
    sort(v.begin(),v.end());
    long long j = 0;
    for(long long i = 0;i < n;i++){
        if(m.count(v[i]))continue;
        m[v[i]] = j;
        j++;
    }
    return ;
}
long long ten(vector<long long> v){
    long long n = v.size();
    map<long long,long long> m;
    ash(m,v);
    st seg(m.size());
    long long ans = 0;
    for(int i = 0;i < n;i++){
        ans += seg.query(m[v[i]]+1,m.size()-1);
        seg.plus(m[v[i]]);
    }
    return ans;
}


```
