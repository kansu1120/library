<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¡ç‚¹ã‚·ã‚¹ãƒ†ãƒ  - kansu C++ Library</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bubbler+One&family=Noto+Serif+JP:wght@400;500&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            font-family: "Noto Serif JP", serif;
            background: #fffdfa;
            color: #332f2c;
            line-height: 1.8;
        }

        .header {
            background: #fffdfa;
            border-bottom: 1px solid #eee;
            padding: 16px 24px;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .header-logo {
            font-family: "Bubbler One", sans-serif;
            display: flex;
            align-items: flex-end;
            gap: 6px;
            text-decoration: none;
        }

        .logo-main {
            font-size: 30px;
            letter-spacing: 0.08em;
            color: #7a0f18;
        }

        .logo-sub {
            font-size: 20px;
            letter-spacing: 0.15em;
            color: #999;
            margin-bottom: 2px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        h1 {
            color: #7a0f18;
            font-size: 32px;
            margin-bottom: 12px;
        }

        .description {
            color: #666;
            margin-bottom: 40px;
            font-size: 16px;
        }

        .section {
            background: white;
            border: 1px solid #eee;
            border-radius: 12px;
            padding: 32px;
            margin-bottom: 32px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .section h2 {
            color: #7a0f18;
            font-size: 24px;
            margin-top: 0;
            margin-bottom: 20px;
            border-bottom: 2px solid #fbe1e1;
            padding-bottom: 8px;
        }

        .form-group {
            margin-bottom: 24px;
        }

        label {
            display: block;
            font-weight: 500;
            margin-bottom: 8px;
            color: #555;
        }

        select, input[type="file"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            font-family: inherit;
            background: white;
        }

        select:focus, input[type="file"]:focus {
            outline: none;
            border-color: #7a0f18;
        }

        .btn {
            background: #7a0f18;
            color: white;
            border: none;
            padding: 14px 32px;
            font-size: 16px;
            border-radius: 8px;
            cursor: pointer;
            font-family: inherit;
            transition: background 0.3s;
        }

        .btn:hover {
            background: #5a0a12;
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .result-box {
            background: #f9f9f9;
            border-left: 4px solid #7a0f18;
            padding: 24px;
            border-radius: 8px;
            margin-top: 24px;
            display: none;
        }

        .result-box.show {
            display: block;
        }

        .score {
            font-size: 48px;
            font-weight: bold;
            color: #7a0f18;
            margin: 16px 0;
        }

        .status {
            padding: 8px 16px;
            border-radius: 6px;
            display: inline-block;
            font-size: 14px;
            margin-bottom: 12px;
        }

        .status.processing {
            background: #fff3cd;
            color: #856404;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
        }

        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #2196f3;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 24px;
        }

        .info-box h3 {
            margin-top: 0;
            color: #1976d2;
        }

        footer {
            text-align: center;
            margin: 40px 0 20px;
            color: #999;
        }

        .footer-brand {
            font-family: "Bubbler One", sans-serif;
            font-size: 18px;
            letter-spacing: 0.15em;
        }

        @media (max-width: 768px) {
            .container {
                padding: 24px 16px;
            }
            
            .section {
                padding: 20px;
            }

            h1 {
                font-size: 24px;
            }

            .score {
                font-size: 36px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <a href="./" class="header-logo">
            <span class="logo-main">kansu</span>
            <span class="logo-sub">C++ Library</span>
        </a>
    </div>

    <div class="container">
        <h1>ã‚³ãƒ³ãƒ†ã‚¹ãƒˆæ¡ç‚¹ã‚·ã‚¹ãƒ†ãƒ </h1>
        <p class="description">
            ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ã€ãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã§è‡ªå‹•æ¡ç‚¹ã—ã¾ã™ã€‚
        </p>

        <div class="info-box">
            <h3>ğŸ“‹ ä½¿ã„æ–¹</h3>
            <ol>
                <li>æ¡ç‚¹ã—ãŸã„ã‚³ãƒ³ãƒ†ã‚¹ãƒˆã‚’é¸æŠã—ã¾ã™</li>
                <li>ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’å«ã‚€ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™</li>
                <li>ã€Œæ¡ç‚¹é–‹å§‹ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™</li>
                <li>ã‚¹ã‚³ã‚¢ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</li>
            </ol>
        </div>

        <div class="section">
            <h2>1. ã‚³ãƒ³ãƒ†ã‚¹ãƒˆã‚’é¸æŠ</h2>
            <div class="form-group">
                <label for="contestSelect">ã‚³ãƒ³ãƒ†ã‚¹ãƒˆ:</label>
                <select id="contestSelect">
                    <option value="">-- ã‚³ãƒ³ãƒ†ã‚¹ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„ --</option>
                    <option value="example">ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ³ãƒ†ã‚¹ãƒˆ</option>
                </select>
            </div>
        </div>

        <div class="section">
            <h2>2. ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</h2>
            <div class="form-group">
                <label for="fileInput">ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«:</label>
                <input type="file" id="fileInput" accept=".txt" />
            </div>
            <p style="color: #666; font-size: 14px;">
                â€» ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã¯ä»¥ä¸‹ã®å½¢å¼ã§ä½œæˆã—ã¦ãã ã•ã„ï¼š<br>
                <code style="background: #f4f4f7; padding: 2px 6px; border-radius: 4px;">
                INPUT:<br>
                (å…¥åŠ›ãƒ‡ãƒ¼ã‚¿)<br>
                EXPECTED:<br>
                (æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›)<br>
                OUTPUT:<br>
                (å®Ÿéš›ã®å‡ºåŠ›)
                </code>
            </p>
        </div>

        <div class="section">
            <h2>3. æ¡ç‚¹ã‚’å®Ÿè¡Œ</h2>
            <button class="btn" id="scoreBtn" disabled>æ¡ç‚¹é–‹å§‹</button>
            
            <div class="result-box" id="resultBox">
                <div class="status" id="statusBox"></div>
                <div id="scoreDisplay"></div>
            </div>
        </div>
    </div>

    <footer>
        <div class="footer-brand">created by kansu</div>
        <a href="https://github.com/kansu1120/library" target="_blank" rel="noopener" style="color: #8b0000;">
            GitHub
        </a>
    </footer>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let scorerModule = null;
        let selectedContest = '';
        let uploadedFile = null;

        // DOMè¦ç´ 
        const contestSelect = document.getElementById('contestSelect');
        const fileInput = document.getElementById('fileInput');
        const scoreBtn = document.getElementById('scoreBtn');
        const resultBox = document.getElementById('resultBox');
        const statusBox = document.getElementById('statusBox');
        const scoreDisplay = document.getElementById('scoreDisplay');

        // ã‚³ãƒ³ãƒ†ã‚¹ãƒˆé¸æŠæ™‚
        contestSelect.addEventListener('change', async (e) => {
            selectedContest = e.target.value;
            scorerModule = null; // ãƒªã‚»ãƒƒãƒˆ
            updateButtonState();

            if (selectedContest) {
                await loadScorerModule(selectedContest);
            }
        });

        // ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠæ™‚
        fileInput.addEventListener('change', (e) => {
            uploadedFile = e.target.files[0];
            updateButtonState();
        });

        // ãƒœã‚¿ãƒ³ã®æœ‰åŠ¹/ç„¡åŠ¹ã‚’æ›´æ–°
        function updateButtonState() {
            scoreBtn.disabled = !(selectedContest && uploadedFile && scorerModule);
        }

        // ã‚¹ã‚³ã‚¢ãƒ©ãƒ¼ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’èª­ã¿è¾¼ã‚€
        async function loadScorerModule(contestName) {
            try {
                statusBox.textContent = 'ã‚¹ã‚³ã‚¢ãƒ©ãƒ¼ã‚’èª­ã¿è¾¼ã¿ä¸­...';
                statusBox.className = 'status processing';
                resultBox.classList.add('show');

                // ã‚¹ã‚³ã‚¢ãƒ©ãƒ¼ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’å‹•çš„ã«èª­ã¿è¾¼ã‚€
                const script = document.createElement('script');
                script.src = `./contests/${contestName}/scorer.js`;
                
                await new Promise((resolve, reject) => {
                    script.onload = resolve;
                    script.onerror = reject;
                    document.head.appendChild(script);
                });

                // ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’åˆæœŸåŒ–
                if (typeof createScorerModule === 'function') {
                    scorerModule = await createScorerModule();
                    statusBox.textContent = 'ã‚¹ã‚³ã‚¢ãƒ©ãƒ¼ã®èª­ã¿è¾¼ã¿ãŒå®Œäº†ã—ã¾ã—ãŸ';
                    statusBox.className = 'status success';
                    updateButtonState();
                } else {
                    throw new Error('ã‚¹ã‚³ã‚¢ãƒ©ãƒ¼ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }
            } catch (error) {
                console.error('Error loading scorer:', error);
                statusBox.textContent = 'ã‚¹ã‚³ã‚¢ãƒ©ãƒ¼ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message;
                statusBox.className = 'status error';
            }
        }

        // æ¡ç‚¹ã‚’å®Ÿè¡Œ
        scoreBtn.addEventListener('click', async () => {
            if (!scorerModule || !uploadedFile) return;

            try {
                scoreBtn.disabled = true;
                statusBox.textContent = 'æ¡ç‚¹ä¸­...';
                statusBox.className = 'status processing';
                scoreDisplay.innerHTML = '';
                resultBox.classList.add('show');

                // ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€
                const fileContent = await readFileAsText(uploadedFile);

                // ã‚¹ã‚³ã‚¢ã‚’è¨ˆç®—
                const dataPtr = scorerModule._malloc(fileContent.length + 1);
                scorerModule.stringToUTF8(fileContent, dataPtr, fileContent.length + 1);
                
                const score = scorerModule._computeScore(dataPtr, fileContent.length);
                
                scorerModule._free(dataPtr);

                // çµæœã‚’è¡¨ç¤º
                statusBox.textContent = 'æ¡ç‚¹å®Œäº†';
                statusBox.className = 'status success';
                scoreDisplay.innerHTML = `
                    <div style="margin-top: 16px;">
                        <div style="color: #666; font-size: 18px;">ã‚¹ã‚³ã‚¢</div>
                        <div class="score">${score.toFixed(2)} ç‚¹</div>
                    </div>
                `;

                scoreBtn.disabled = false;
            } catch (error) {
                console.error('Scoring error:', error);
                statusBox.textContent = 'æ¡ç‚¹ã‚¨ãƒ©ãƒ¼: ' + error.message;
                statusBox.className = 'status error';
                scoreDisplay.innerHTML = '';
                scoreBtn.disabled = false;
            }
        });

        // ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ†ã‚­ã‚¹ãƒˆã¨ã—ã¦èª­ã¿è¾¼ã‚€
        function readFileAsText(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => resolve(e.target.result);
                reader.onerror = reject;
                reader.readAsText(file);
            });
        }
    </script>
</body>
</html>
